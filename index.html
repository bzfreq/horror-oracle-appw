 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horror Oracle</title>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Roboto:wght@300;400;500;700&family=Nosifer&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .bg-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url('https://placehold.co/1920x1080/000/fff'); /* Placeholder, you can replace with your own horror image */
        background-size: cover;
        background-position: center;
        filter: brightness(0.2);
        z-index: -1;
    }

    .main-container {
      width: 100%;
      max-width: 1200px;
      padding: 2rem;
      position: relative;
      z-index: 10;
    }

    .chat-interface {
      display: none;
      height: calc(100vh - 4rem);
      max-height: 800px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #333;
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      overflow: hidden;
      display: grid;
      grid-template-columns: 3fr 1fr;
      transition: all 0.5s ease-in-out;
    }
    
    .chat-area {
        display: flex;
        flex-direction: column;
        height: 100%;
        padding: 1rem;
    }
    
    .messages {
      flex-grow: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding-right: 0.5rem;
    }
    
    .messages::-webkit-scrollbar {
        width: 8px;
    }
    
    .messages::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .messages::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 4px;
    }
    
    .messages::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
    
    .message-bubble.user {
      align-self: flex-end;
      background: #262626;
      border-radius: 1rem 1rem 0 1rem;
      padding: 0.75rem 1rem;
    }
    
    .message-bubble.bot {
      align-self: flex-start;
      background: #1c1c1c;
      border-radius: 1rem 1rem 1rem 0;
      padding: 0.75rem 1rem;
    }

    .recommendations-area {
      background: rgba(0, 0, 0, 0.4);
      border-left: 1px solid #333;
      padding: 1.5rem 1rem;
      overflow-y: auto;
    }

    .rec-card {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem;
        cursor: pointer;
        transition: background-color 0.2s;
        border-radius: 0.5rem;
    }
    
    .rec-card:hover {
        background: rgba(255, 255, 255, 0.05);
    }
    
    .rec-card img {
        width: 40px;
        height: 60px;
        object-fit: cover;
        border-radius: 4px;
    }
    
    .rec-card div {
        flex: 1;
    }

    .center-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
      transition: opacity 0.5s ease-in-out;
    }

    .blood-drop {
        position: fixed;
        width: 15px;
        height: 15px;
        background-color: #7d0b0b;
        border-radius: 50%;
        animation: drop linear infinite;
        pointer-events: none;
    }

    @keyframes drop {
        0% { transform: translateY(-10vh) scale(0); opacity: 0; }
        5% { transform: translateY(0vh) scale(1); opacity: 1; }
        100% { transform: translateY(110vh) scale(1); opacity: 0; }
    }

    .flicker {
      animation: flicker 0.1s infinite;
    }

    @keyframes flicker {
      0% { opacity: 1; }
      50% { opacity: 0.8; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

  <div class="bg-image"></div>
  
  <div id="landing-page" class="center-content">
      <h1 class="text-6xl md:text-8xl font-bold text-red-700 tracking-wider mb-8 drop-shadow-xl creepster">
          HORROR ORACLE
      </h1>
      <p class="text-xl md:text-2xl text-gray-300 font-light mb-8 max-w-2xl px-4">
          Enter the crypt and ask the Oracle your deepest, darkest questions about horror movies.
      </p>
      <div class="w-full max-w-xl relative">
          <input type="text" id="initial-input" placeholder="Ask about a movie..." 
                 class="w-full bg-gray-900 border border-gray-700 rounded-full py-4 px-6 text-lg text-gray-200 focus:outline-none focus:border-red-600 transition-colors">
          <button id="initial-btn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-6 rounded-full transition-colors">
              Ask
          </button>
      </div>
  </div>

  <div id="chat-page" class="chat-interface hidden">
    <div class="chat-area">
      <div class="messages flex-grow overflow-y-auto pr-2">
        </div>
      <div class="mt-4 flex gap-2">
        <input type="text" id="userInput" placeholder="Ask the Oracle a question..." class="flex-grow bg-[#1a1a1a] text-white border border-[#333] rounded-full py-3 px-5 focus:outline-none focus:border-red-600 transition-colors">
        <button id="sendBtn" class="bg-red-700 text-white rounded-full py-3 px-6 hover:bg-red-800 transition-colors">
          Send
        </button>
      </div>
    </div>
    
    <div class="recommendations-area">
        <h2 class="text-2xl font-bold text-red-700 mb-4 creepster">Recommendations</h2>
        <div id="rec-container" class="space-y-4">
            <p class="text-gray-400 text-sm">Recommendations will appear here after your first query.</p>
        </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const landingPage = document.getElementById('landing-page');
      const chatPage = document.getElementById('chat-page');
      const initialInput = document.getElementById('initial-input');
      const initialBtn = document.getElementById('initial-btn');
      const userInput = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');
      const messagesContainer = document.querySelector('.messages');
      const recContainer = document.getElementById('rec-container');

      function hideLandingPage() {
        landingPage.classList.add('hidden');
        chatPage.classList.remove('hidden');
      }

      function appendMessage(sender, text, posterUrl, amazonLink, interestingFact) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message-bubble max-w-[80%] md:max-w-[60%] ${sender === 'user' ? 'user' : 'bot'} text-sm`;

        if (sender === 'user') {
          messageDiv.textContent = text;
        } else {
          let html = '';
          if (posterUrl) {
            html += `<div class="mb-4"><img src="${posterUrl}" alt="Movie Poster" class="rounded-lg max-w-full"></div>`;
          }
          html += `<div>${processMarkdown(text)}</div>`;
          if (interestingFact) {
            html += `<div class="mt-4 text-xs italic text-gray-400">Fact: ${interestingFact}</div>`;
          }
          if (amazonLink) {
            html += `<a href="${amazonLink}" target="_blank" class="mt-4 inline-block text-red-400 hover:text-red-300 transition-colors text-xs">Buy or rent on Amazon</a>`;
          }
          messageDiv.innerHTML = html;
        }
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
      
      // Function to process markdown for bot responses
      function processMarkdown(text) {
          text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
          text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
          text = text.replace(/\\n/g, '<br>');
          return text;
      }

      async function sendMessage(inputElement) {
        const query = inputElement.value.trim();
        if (!query) return;

        appendMessage('user', query);
        inputElement.value = '';

        try {
          const response = await fetch('/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query })
          });

          const data = await response.json();
          appendMessage('bot', data.summary || "The Oracle is silent...", data.poster_url, data.amazon_link, data.interesting_fact);

          // Show recommendations in sidebar
          recContainer.innerHTML = '';
          if (data.recommendations && data.recommendations.length > 0) {
            data.recommendations.forEach(rec => {
              const card = document.createElement('div');
              card.className = "rec-card";
              card.innerHTML = `
                <img src="${rec.poster_url || 'https://placehold.co/40x60'}" alt="">
                <div>
                  <div class="text-sm font-bold">${rec.title}</div>
                  <div class="text-xs text-gray-400">${rec.year || ''}</div>
                </div>
              `;
              card.onclick = () => {
                userInput.value = rec.title;
                sendMessage(userInput);
              };
              recContainer.appendChild(card);
            });
          } else {
            recContainer.innerHTML = '<p class="text-gray-400 text-sm">No recommendations found</p>';
          }
        } catch (err) {
          appendMessage('bot', "Dark forces block my vision. Try again later.");
        }
      }

      initialBtn.addEventListener('click', () => {
        hideLandingPage();
        sendMessage(initialInput);
      });

      initialInput.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          hideLandingPage();
          sendMessage(initialInput);
        }
      });
      
      sendBtn.addEventListener('click', () => sendMessage(userInput));
      userInput.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          sendMessage(userInput);
        }
      });

    });
  </script>
</body>
</html>
