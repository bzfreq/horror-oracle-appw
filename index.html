<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horror Oracle</title>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Roboto:wght@300;400;500;700&family=Nosifer&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg-color: #0a0a0a;
      --text-color: #e0e0e0;
      --accent-color: #b91c1c;
      --secondary-color: #7d1414;
      --input-bg: #1a1a1a;
      --chat-bg: #111111;
      --user-bubble: #333;
      --bot-bubble: #222;
      --blood-color: #7d0b0b;
    }
    /* --- all your CSS unchanged --- */
  </style>
</head>
<body>
    <div class="fixed top-0 left-0 w-full h-full -z-10 opacity-30 pointer-events-none" style="background-image: radial-gradient(circle at center, rgba(185, 28, 28, 0.1) 0%, rgba(10, 10, 10, 0.8) 70%);"></div>

    <div class="centered-container mx-auto">
        <header class="w-full flex justify-between items-center p-4">
            <div class="flex items-center space-x-4">
                <h1 class="nosifer text-4xl text-white logo-glow">Horror Oracle</h1>
                <div class="hidden md:flex space-x-3">
                    <button id="news-btn" class="px-4 py-2 text-sm bg-gray-800 rounded-full border border-gray-700 text-gray-300 hover:bg-gray-700 transition-colors">Horror News</button>
                    <button id="toggle-releases" class="px-4 py-2 text-sm bg-gray-800 rounded-full border border-gray-700 text-gray-300 hover:bg-gray-700 transition-colors">Recent Releases</button>
                    <button id="forum-btn" class="px-4 py-2 text-sm bg-gray-800 rounded-full border border-gray-700 text-gray-300 hover:bg-gray-700 transition-colors">Horror Forum</button>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- left panel + chat + right panel all your same HTML -->
        </div>
    </div>

    <script>
    // DOM setup + helper functions unchanged...

    // sendMessage FIXED
    async function sendMessage() {
        const query = userInput.value.trim();
        if (query === '') return;

        appendMessage('user', query);
        userInput.value = '';

        const loadingBubble = document.createElement('div');
        loadingBubble.className = "bot-bubble text-sm skeleton-loading rounded-full w-32 h-12";
        loadingBubble.id = "loading-bubble";
        chatHistory.appendChild(loadingBubble);
        chatHistory.scrollTop = chatHistory.scrollHeight;

        const timestamp = new Date().getTime();
        try {
            const response = await fetch(`/ask-oracle?nocache=${timestamp}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                },
                body: JSON.stringify({ query, timestamp })
            });

            if (!response.ok) throw new Error(`Network error: ${response.status}`);
            const data = await response.json();

            document.getElementById("loading-bubble")?.remove();
            let fullResponse = data.summary || '';
            if (data.interesting_fact) {
                fullResponse += `<br><br><strong>Interesting Fact:</strong> ${data.interesting_fact}`;
            }
            currentMovieTitle = data.movie_title;
            appendMessage('bot', fullResponse, data.movie_title, data.amazon_link);

        } catch (error) {
            document.getElementById("loading-bubble")?.remove();
            appendMessage('bot', "The Oracle cannot see that information right now.");
        }
    }

    // toggleReleases FIXED
    async function toggleReleases() {
        try {
            appendMessage('bot', "Conjuring a list of recent releases...");
            const timestamp = new Date().getTime();
            const response = await fetch(`/recent-releases?t=${timestamp}`, {
                headers: {
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                }
            });
            if (!response.ok) throw new Error(`HTTP error! ${response.status}`);
            const data = await response.json();

            if (data.releases?.length > 0) {
                let releasesText = "ðŸ”® <strong>Recent Horror Releases</strong> ðŸ”®<br><br>";
                data.releases.forEach(r => {
                    const releaseDate = new Date(r.release_date).toLocaleDateString();
                    releasesText += `â€¢ <strong>${r.title}</strong> (${releaseDate})<br>`;
                });
                appendMessage('bot', releasesText);
            } else {
                appendMessage('bot', "The Oracle cannot foresee releases right now.");
            }
        } catch (err) {
            appendMessage('bot', "Dark forces block the release list...");
        }
    }

    // all your other functions unchanged...

    // Screen flicker effect
    function triggerFlicker() {
        document.body.classList.add('flicker');
        setTimeout(() => {
            document.body.classList.remove('flicker');
        }, 100);
    }

    // Create spooky effects when a horror movie is found
    function triggerHorrorEffects() {
        for (let i = 0; i < 10; i++) {
            setTimeout(() => createBloodDrop(), i * 200);
        }
        for (let i = 0; i < 3; i++) {
            setTimeout(() => createBloodSplatter(), i * 500);
        }
        triggerFlicker();
        setTimeout(() => triggerFlicker(), 300);
        setTimeout(() => triggerFlicker(), 1200);
    }

    // Process markdown text
    function processMarkdown(text) {
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        text = text.replace(/\n/g, '<br>');
        return text;
    }

    // Event listeners
    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            sendMessage();
        }
    });
    toggleReleasesBtn.addEventListener('click', toggleReleases);
    newsBtn.addEventListener('click', showHorrorNews);
    forumBtn.addEventListener('click', showForumPreview);

    // Load initial list on page load
    loadMyList();

    // Initial effect
    setTimeout(() => {
        createBloodDrop();
        setTimeout(() => createBloodDrop(), 300);
        setTimeout(() => createBloodSplatter(), 800);
    }, 1000);
    </script>
</body>
</html>
